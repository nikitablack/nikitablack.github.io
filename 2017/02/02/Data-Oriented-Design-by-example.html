<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <title>Data Oriented Design by example</title>
    <meta name="description" content="" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="https://nikitablack.github.io/favicon.ico">

    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:400,700,400italic,700italic|Open+Sans:400italic,700italic,700,400">
    <link rel="stylesheet" type="text/css" href="//nikitablack.github.io/themes/roon/assets/css/screen.css?v=1486139911558" />

    <link rel="canonical" href="https://nikitablack.github.io/2017/02/02/Data-Oriented-Design-by-example.html" />
    <meta name="referrer" content="origin" />
    
    <meta property="og:site_name" content="Simply about complex" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Data Oriented Design by example" />
    <meta property="og:description" content="The last couple of years interesting but not so popular paradigm appears more often. I&amp;#8217;m talking about Data Oriented Design (DOD). If you&amp;#8217;re searching for a job that involves high-performance calculations be ready to hear corresponding questions. And I was surprised knowing that some my colleagues" />
    <meta property="og:url" content="https://nikitablack.github.io/2017/02/02/Data-Oriented-Design-by-example.html" />
    <meta property="article:tag" content="c++" />
    <meta property="article:tag" content=" dod" />
    
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Data Oriented Design by example" />
    <meta name="twitter:description" content="The last couple of years interesting but not so popular paradigm appears more often. I&amp;#8217;m talking about Data Oriented Design (DOD). If you&amp;#8217;re searching for a job that involves high-performance calculations be ready to hear corresponding questions. And I was surprised knowing that some my colleagues" />
    <meta name="twitter:url" content="https://nikitablack.github.io/2017/02/02/Data-Oriented-Design-by-example.html" />
    
    <script type="application/ld+json">
null
    </script>

    <meta name="generator" content="HubPress" />
    <link rel="alternate" type="application/rss+xml" title="Simply about complex" href="https://nikitablack.github.io/rss/" />
</head>
<body class="post-template tag-c tag-dod  noimage">

    


    <article role="main" class="">
        <header>
            <a href="https://nikitablack.github.io" id="home_link">«</a>
            <div class="meta"><time datetime="2017-02-02"><a href="https://nikitablack.github.io/2017/02/02/Data-Oriented-Design-by-example.html">February 02, 2017</a></time> <span class="count" id="js-reading-time"></span></div>
            <h1>Data Oriented Design by example</h1>
        </header>

        <div class="text" id="js-post-content">
            <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The last couple of years interesting but not so popular paradigm appears more often. I&#8217;m talking about <strong>Data Oriented Design</strong> (<strong>DOD</strong>). If you&#8217;re searching for a job that involves high-performance calculations be ready to hear corresponding questions. And I was surprised knowing that some my colleagues have never heard about the approach and after the short discussion stayed skeptical. In this article I&#8217;ll try to compare traditional <strong>OOP</strong> approach with <strong>DOD</strong> on a real world example.</p>
</div>
<div class="paragraph">
<p>The Russian version of the post is <a href="https://habrahabr.ru/post/321106/">here</a>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_what_is_dod">What is DOD?</h5>
<div class="paragraph">
<p>This post is an attempt to compare different programming approach without trying to explain them. I assume you know what we&#8217;ll talk about. There&#8217;re a lot of articles on the web about the subject. <a href="https://fuzzyreflection.com/2016/07/14/maximizing-code-performance-by-thinking-data-first-part-1/">This one</a> is good. <a href="https://www.youtube.com/watch?v=rX0ItVEVjHc">This video</a> from <strong>CppCon</strong> also is a <em>must see</em>. But in layman&#8217;s terms, <strong>DOD</strong> is a way to work with data in <em>cache friendly</em> manner. Better see an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">#include &lt;chrono&gt;
#include &lt;iostream&gt;
#include &lt;vector&gt;

using namespace std;
using namespace std::chrono;

struct S
{
	uint64_t u;
	double d;
	int i;
	float f;
};

struct Data
{
	vector&lt;uint64_t&gt; vu;
	vector&lt;double&gt; vd;
	vector&lt;int&gt; vi;
	vector&lt;float&gt; vf;
};

int test1(S const &amp; s1, S const &amp; s2)
{
	return s1.i + s2.i;
}

int test2(Data const &amp; data, size_t const ind1, size_t const ind2)
{
	return data.vi[ind1] + data.vi[ind2];
}

int main()
{
	size_t const N{ 30000 };
	size_t const R{ 10 };

	vector&lt;S&gt; v(N);
	Data data;
	data.vu.resize(N);
	data.vd.resize(N);
	data.vi.resize(N);
	data.vf.resize(N);

	int result{ 0 };

	cout &lt;&lt; "test #1" &lt;&lt; endl;
	for (uint32_t i{ 0 }; i &lt; R; ++i)
	{
		auto const start{ high_resolution_clock::now() };
		for (size_t a{ 0 }; a &lt; v.size() - 1; ++a)
		{
			for (size_t b{ a + 1 }; b &lt; v.size(); ++b)
			{
				result += test1(v[a], v[b]);
			}
		}
		cout &lt;&lt; duration&lt;float&gt;{ high_resolution_clock::now() - start }.count() &lt;&lt; endl;
	}

	cout &lt;&lt; "test #2" &lt;&lt; endl;
	for (uint32_t i{ 0 }; i &lt; R; ++i)
	{
		auto const start{ high_resolution_clock::now() };
		for (size_t a{ 0 }; a &lt; v.size() - 1; ++a)
		{
			for (size_t b{ a + 1 }; b &lt; v.size(); ++b)
			{
				result += test2(data, a, b);
			}
		}
		cout &lt;&lt; duration&lt;float&gt;{ high_resolution_clock::now() - start }.count() &lt;&lt; endl;
	}

    return result;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The second test runs faster by <code>30%</code> (in VS2017 and gcc7.0.1). But why?</p>
</div>
<div class="paragraph">
<p>The size of the <code>S</code> struct is <code>24</code> bytes. My CPU (Intel Core i7) have <code>32KB</code> L1 cache for each core with <code>64B</code> cache line. That means that when we&#8217;re requesting data from the main memory one cache line can hold only two full <code>S</code> structs at most. In the first test we&#8217;re reading only one <code>int</code> field, i.e. in the best case scenario one cache line can hold only two <code>S::i</code> (ok, sometimes three). In the second test we&#8217;re reading similar <code>int</code> but from the vector of integers. <code>std::vector</code> guarantees sequentiality of the data it holds. That means that one cache line can hold up to <code>16</code> (<code>64KB</code> / <code>sizeof(int)</code> = <code>16</code>) values we need. Obviously, we&#8217;re communicating with the RAM less often. And it&#8217;s known that memory operations are the bottleneck in modern CPUs.</p>
</div>
</div>
<div class="sect4">
<h5 id="_what_about_real_life">What about real life?</h5>
<div class="paragraph">
<p>The example above clearly shows the benefits of <strong>SoA</strong> (<strong>S</strong>truct <strong>o</strong>f <strong>A</strong>rrays) vs <strong>AoS</strong> (<strong>A</strong>rray <strong>o</strong>f <strong>S</strong>tructures). But this example was from the <em>Hello World</em> category, i.e. it&#8217;s very far from real world applications. In reality, the code has lots of dependencies and specific data which probably will not give such performance increase. One more thing - if in our example we&#8217;ll read all fields of the struct there will be no difference in speed.</p>
</div>
<div class="paragraph">
<p>In order to understand possibility to apply <strong>DOD</strong> I decided to write more or less complex program with both (<strong>OOP</strong> and <strong>DOD</strong>) approaches. Let it be a <code>2d</code> rigid body simulation - we&#8217;ll create <strong>N</strong> convex polygons with different parameters - mass, speed etc. - and we&#8217;ll see how many such objects we can simulate staying at <code>30</code> fps.</p>
</div>
</div>
<div class="sect4">
<h5 id="_array_of_structures">Array of Structures</h5>
<div class="paragraph">
<p><strong>Initial program</strong></p>
</div>
<div class="paragraph">
<p>Source code for this version can be found in <a href="https://github.com/nikitablack/cpp-tests/tree/b672ca106ef5c88a23d7f8e2a909e07d6e54ca4a/data_oriented/oop/oop">this</a> commit and we briefly run through the code.</p>
</div>
<div class="paragraph">
<p>For simplicity reasons the program is written in Visual Studio for Windows and uses DirectX11 for rendering.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
I&#8217;m using the latest VS2017 and some features of c++17, namely <a href="http://en.cppreference.com/w/cpp/utility/optional">std::optional</a>. Intersection detector takes two objects and returns by value a struct with intersection information - normal, penetration depth. Previously I used a boolean flag inside that structure that showed was there an intersection at all. With the new <code>std::optional</code> I got rid of that flag and the code became more clear.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The purpose of this article is to show some numbers on CPU so we&#8217;ll not discuss graphics.</p>
</div>
<div class="paragraph">
<p>The <code>Shape</code> class which represents physical body looks like this (simplified):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">class Shape
{
public:
	math::Vec2 position{ 0.0f, 0.0f };
	math::Vec2 velocity{ 0.0f, 0.0f };
	math::Vec2 overlapResolveAccumulator{ 0.0f, 0.0f };
	float massInverse;
	math::Color color;
	std::vector&lt;math::Vec2&gt; vertices;
	math::Bounds bounds;
};</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>I believe <code>position</code> and <code>velocity</code> fields don&#8217;t need a discussion</p>
</li>
<li>
<p><code>vertices</code> — a random number of polygon vertices</p>
</li>
<li>
<p><code>bounds</code> — shape&#8217;s bounding box. Used for broad collision detection</p>
</li>
<li>
<p><code>massInverse</code> — one over mass (<code>1 / m</code>). We&#8217;ll use only this value so no need to keep mass itself</p>
</li>
<li>
<p><code>color</code> — used for rendering but stored in shape</p>
</li>
<li>
<p><code>overlapResolveAccumulator</code> - see below.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
From the structure, it&#8217;s already seen that <code>color</code> not used for calculations at all. But steel takes place in the cache line.
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="https://raw.githubusercontent.com/nikitablack/articles_stuff/master/dod_by_example/1.png" alt="1" width="400">
</div>
</div>
<div class="paragraph">
<p>When the triangle intersects shape <code>a</code> we need to move it apart to avoid figures overlapping. Also, we have to recalculate <code>bounds</code>. But now the triangle intersects shape <code>b</code> and we need to repeat the procedure again - move the shape and recalculate bounds. Notice that after the second move the triangle again will be over shape <code>a</code>. To avoid this repetition we&#8217;ll store the value necessary to separate objects in special accumulator - <code>overlapResolveAccumulator</code> - and later will move the shape by this value but only once. Not physically correct at all, but looks ok. Notice also that this field also adds to the total size of the class which is not good for the memory.</p>
</div>
<div class="paragraph">
<p>The heart of our program is a <code>ShapesApp::update()</code> function. Here it&#8217;s simplified form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">void ShapesApp::update(float const dt)
{
	float const dtStep{ dt / NUM_PHYSICS_STEPS };
	for (uint32_t s{ 0 }; s &lt; NUM_PHYSICS_STEPS; ++s)
	{
		updatePositions(dtStep);

		for (size_t i{ 0 }; i &lt; _shapes.size() - 1; ++i)
		{
			for (size_t j{ i + 1 }; j &lt; _shapes.size(); ++j)
			{
				CollisionSolver::solveCollision(_shapes[i].get(), _shapes[j].get());
			}
		}
	}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Every frame we call a <code>ShapesApp::updatePositions()</code> function that updates every shape&#8217;s <code>position</code> and <code>bounds</code>. Next we check every shape with every other for collision in <code>CollisionSolver::solveCollision()</code> function. I used <a href="https://en.wikipedia.org/wiki/Hyperplane_separation_theorem">Separating Axis Theorem</a> (<strong>SAT</strong>) for that. And we repeat these steps <code>NUM_PHYSICS_STEPS</code> times. This variable serves several purposes - first, the physics becomes more stable, and second, it limits the number of objects on the screen. <strong>c++</strong> is fast, amazingly fast, and without this limitation we&#8217;ll have tens of thosands of objects which will lead to rendering performance issues. In my tests I used <code>NUM_PHYSICS_STEPS = 20</code>.</p>
</div>
<div class="paragraph">
<p>On my humble laptop this version of the program simulates <code>500</code> shapes before fps starts to drop below <code>30</code>. Wat?? Only <code>500</code>?? Even JavaScript can do better. I agree, not a lot, but don&#8217;t forget - we&#8217;re repeating calculations <code>20</code> times per frame.</p>
</div>
<div class="paragraph">
<p>I think I need to add some pictures to make the post not so boring, so here we go:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://raw.githubusercontent.com/nikitablack/articles_stuff/master/dod_by_example/2.png" alt="2" width="600">
</div>
</div>
<div class="paragraph">
<p><strong>Optimization #1. Spatial Grid</strong></p>
</div>
<div class="paragraph">
<p>I mentioned several times that I want to make tests on a program which is as close to real world as possible. Obviously, the code above is not usable - nobody checks each shape with each other - this is veeeery slow. For acceleration usually, some spetial spatial structure being used. We&#8217;ll use simple <code>2d</code> grid - I called it <code>Grid</code> in the code - which consists of <code>NxM</code> cells - <code>struct Cell</code>. At the calculation start we&#8217;ll put each object in the corresponding cell. This way all we have to do is to iterate over cells and check intersection between several pairs of objects. I used the similar code a lot of times in real projects and it behaved very well. Besides, it&#8217;s very easy to implement, easy to debug and understand.</p>
</div>
<div class="paragraph">
<p>The commit for this version can be found <a href="https://github.com/nikitablack/cpp-tests/tree/8364d7c55c8948ab2fc5630e828d44551c6db951/data_oriented/oop/oop">here</a>. We added a new entity - <code>Grid</code> and changed <code>ShapesApp::update()</code> function. Now it calls <code>Grid</code>'s methods for updating and intersections.</p>
</div>
<div class="paragraph">
<p>This version can simulate <code>8000</code> shapes now at <code>30</code> fps (don&#8217;t forget about <code>20</code> repetitions in each frame)! I had to decrease shape&#8217;s sizes in order to fit them in the window.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://raw.githubusercontent.com/nikitablack/articles_stuff/master/dod_by_example/3.png" alt="3" width="600">
</div>
</div>
<div class="paragraph">
<p><strong>Optimization #2. Multithreading.</strong></p>
</div>
<div class="paragraph">
<p>These days, when even cell phones have <code>4</code> cores inside, ignore multithreading is silly. In this, the last optimization we&#8217;ll add a thread pool and will divide main work by equal tasks. For example, <code>ShapesApp::updatePositions()</code> which iterated over all shapes before now iterates only over a part of the shapes on each core. Thread pool class was taken from <a href="https://github.com/progschj/ThreadPool/blob/master/ThreadPool.h">here</a> and the final version of the program you can find <a href="https://github.com/nikitablack/cpp-tests/tree/8d83cb351008a3faf3629279ebaf49ff3fc71b17/data_oriented/oop/oop">in this</a> commit. In my tests, I used <code>4</code> threads (including main).</p>
</div>
<div class="paragraph">
<p>Dividing the work by tasks added some head pain. For example, if a shape crosses cell boundaries it will end in several cells at the same time.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://raw.githubusercontent.com/nikitablack/articles_stuff/master/dod_by_example/4.png" alt="4" width="400">
</div>
</div>
<div class="paragraph">
<p>Here the shape <code>a</code> fully contained in one cell, but <code>b</code> is in <code>4</code> cells at the same time. Because of this, we have to synchronize cell access. Also, we have to synchronize access to some fields inside the <code>Shape</code> class. We can achieve this adding <code>std::mutex</code> to the <code>Shape</code> and <code>Cell</code>.</p>
</div>
<div class="paragraph">
<p>Now I can see <code>13000</code> shapes at <code>30</code> fps. For such amount of objects, I had to increase the window size. And I say it again - in every frame we&#8217;re repeating simulation <code>20</code> times.</p>
</div>
<div class="paragraph">
<p>To be honest this program has bad parallelization possibilities. That&#8217;s why increasing the number of threads will not give us a significant performance boost. But that&#8217;s another story.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://raw.githubusercontent.com/nikitablack/articles_stuff/master/dod_by_example/5.png" alt="Teapot" width="600">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_structure_of_arrays">Structure of Arrays</h5>
<div class="paragraph">
<p><strong>Initial program</strong></p>
</div>
<div class="paragraph">
<p>The code we wrote above I call traditional <strong>OOP</strong> approach - I write such code many years and see similar code in general. But now we&#8217;ll modify it a little - we&#8217;ll remove class <code>Shape</code> and replace it with vectors and see can this tiny change affect the performance? To my happiness refactoring wasn&#8217;t hard, even trivial. Instead of the <code>Shape</code> class, we&#8217;ll use a struct with vectors of data.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">struct ShapesData
{
	std::vector&lt;math::Vec2&gt; positions;
	std::vector&lt;math::Vec2&gt; velocities;
	std::vector&lt;math::Vec2&gt; overlapAccumulators;
	std::vector&lt;float&gt; massesInverses;
	std::vector&lt;math::Color&gt; colors;
	std::vector&lt;std::vector&lt;math::Vec2&gt;&gt; vertices;
	std::vector&lt;math::Bounds&gt; bounds;
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>We pass this struct like this - <code>solveCollision(struct ShapesData &amp; data, std::size_t const indA, std::size_t const indB)</code>. I.e. instead of shapes instances we pass indices and inside function necessary data is taking from the vectors.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/nikitablack/cpp-tests/tree/8363e60c614377cccb777625805b6aea9e699117/data_oriented/dod/dod">This version</a> of the program can simulate <code>500</code> objects at <code>30</code> fps. As you can see there&#8217;s no difference with the original version. This is because we have relatively small data set and the "heaviest" function uses almost all fields of the struct.</p>
</div>
<div class="paragraph">
<p>Further without pictures since they are the same.</p>
</div>
<div class="paragraph">
<p><strong>Optimization #1. Spatial Grid</strong></p>
</div>
<div class="paragraph">
<p>Everything as before except only we switch to <strong>SoA</strong> instead of <strong>AoS</strong>. The source code is <a href="https://github.com/nikitablack/cpp-tests/tree/f726cec7591a2568ef41fbe53623e5447bfdde45/data_oriented/dod/dod">here</a>. The result is better - <code>9500</code> objects vs <code>8000</code> before, i.e. the performance difference is around <code>15%</code>.</p>
</div>
<div class="paragraph">
<p><strong>Optimization #2. Multithreading.</strong></p>
</div>
<div class="paragraph">
<p>Again take the old code, switch structs and get <code>15000</code> objects at <code>30</code> fps. Again performance increase is around <code>15%</code>. <a href="https://github.com/nikitablack/cpp-tests/tree/ba57d299a26545d6045bd84797bc69d98ceca7bd/data_oriented/dod/dod">Here&#8217;s</a> the final version of the program.</p>
</div>
</div>
<div class="sect4">
<h5 id="_conclusion">Conclusion</h5>
<div class="paragraph">
<p>I satisfied with the results. As you can see the small change in the code can lead to the quite big performance boost. But not always. It&#8217;s even possible to lose some speed. For example, if we need only one instance of a class then with a traditional approach we read the data from memory once and have an access to all fields. On the other side if we read each field individually via vectors we have cache miss on each reading. Moreover, the general readability and complexity become worse.</p>
</div>
<div class="paragraph">
<p>As usual, it&#8217;s hard to give an unambiguous answer - should everybody switch to the new paradigm? When I worked on a <code>3d</code> game engine <code>10%</code> performance increase was a huge number. But when I worked on game launcher, mostly UI, then usage of this approach would only cause bewilderment of my colleagues. As general advice - profile, measure and decide yourself. Sincirelly yours, Cpt. Obvious.</p>
</div>
</div>
        </div>


        <footer class="post-footer" role="contentinfo">

            <div class="vcard">s
                <a href="https://nikitablack.github.io/rss/feed.rss" id="btn_feed" class="btn" title="Feed" target="_blank">
                    <span aria-hidden="true" data-icon=")"></span>
                    <strong>Feed</strong>
                </a>

                <a href="https://nikitablack.github.io/author/nikitablack/" class="photo">
                    <span style="background-image: url('https://avatars.githubusercontent.com/u/6390092?v&#x3D;3');">
                        <img src="https://avatars.githubusercontent.com/u/6390092?v&#x3D;3" alt="nikitablack">
                    </span>
                </a>

                <div class="details">
                    <h4><a href="https://nikitablack.github.io/author/nikitablack/" class="url n">nikitablack</a></h4>
                    
                    <a href="https://nikitablack.github.io" class="js-remove-domain-schema">https://nikitablack.github.io</a>
                </div>
            </div>

            <div id="user_bio">
                <div class="inner">
                    
                </div>
            </div>

        </footer>




    <section class="post-comments">
      <div id="disqus_thread"></div>
      <script type="text/javascript">
      var disqus_shortname = 'nikitablack'; // required: replace example with your forum shortname
      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
      </script>
      <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
      <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </section>


    </article>

    <div id="share_modal">
        <div class="wrap">
            <div class="inner">
                <header>
                    Share
                    <a href="" class="close" title="Close">&times;</a>
                </header>

                <div class="roon-share-links">
                    <a href="https://twitter.com/share" class="twitter-share-button" data-dnt="true">Tweet</a>
                    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

                    <div id="fb-elems">
                        <div id="fb-root"></div>
                        <script>(function(d, s, id) {
                        var js, fjs = d.getElementsByTagName(s)[0];
                        if (d.getElementById(id)) return;
                        js = d.createElement(s); js.id = id;
                        js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=463438580397968";
                        fjs.parentNode.insertBefore(js, fjs);
                        }(document, 'script', 'facebook-jssdk'));</script>
                        <div class="fb-like" data-send="false" data-layout="button_count" data-width="110" data-show-faces="false" data-font="arial"></div>
                    </div>

                    <div id="pinit-btn">
                        <a href="//pinterest.com/pin/create/button/?url=https://nikitablack.github.io/2017/02/02/Data-Oriented-Design-by-example.html&amp;description=Data%20Oriented%20Design%20by%20example-Simply%20about%20complex " data-pin-do="buttonPin" data-pin-config="beside"><img src="//assets.pinterest.com/images/pidgets/pin_it_button.png"></a>
                        <script type="text/javascript" src="//assets.pinterest.com/js/pinit.js"></script>
                    </div>
                </div>
            </div>
        </div>
    </div>




        <a href="https://nikitablack.github.io" id="blog_badge">
            <span style="background-image: url('https://raw.githubusercontent.com/nikitablack/nikitablack.github.io/master/images/logo.jpg');">Simply about complex</span>
        </a>


    <script>

            function get_text(el) {
                ret = "";
                var length = el.childNodes.length;
                for(var i = 0; i < length; i++) {
                    var node = el.childNodes[i];
                    if(node.nodeType != 8) {
                        ret += node.nodeType != 1 ? node.nodeValue : get_text(node);
                    }
                }
                return ret;
            }
            function reading_time () {
                var post_content = document.getElementById('js-post-content');
                if (post_content) {
                    var words = get_text(post_content),
                        count = words.split(/\s+/).length,
                        read_time = Math.ceil((count / 150)),
                        read_time_node = document.createTextNode(read_time + ' min read');
                    document.getElementById('js-reading-time').appendChild(read_time_node);
                }
            }

        function no_schema_links () {
            var links = document.querySelectorAll('.js-remove-domain-schema');
            if (links) {
                for (i = 0; i < links.length; ++i) {
                    var link = links[i],
                        text = link.innerHTML,
                        no_schema = text.replace(/.*?:\/\//g, "");
                    link.innerHTML = no_schema;
                }
            }
        }

        window.onload = function () {
            no_schema_links();

            reading_time();
        }
    </script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js?v="></script> <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment-with-locales.min.js?v="></script> <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js?v="></script> 
      <script type="text/javascript">
        jQuery( document ).ready(function() {
          // change date with ago
          jQuery('ago.ago').each(function(){
            var element = jQuery(this).parent();
            element.html( moment(element.text()).fromNow());
          });
        });

        hljs.initHighlightingOnLoad();
      </script>

        <script>
            $(function(){
                var share_modal = $("#share_modal"),
                    update_social_links = true;

                $("#btn_share").click(function(){
                    var that = $(this);
                    share_modal.fadeIn(200);
                    return false;
                });

                share_modal.click(function(e){
                    if (e.target.className == "wrap" || e.target.id == "share_modal") {
                        share_modal.fadeOut(200);
                    }
                    return false;
                });

                share_modal.find("div.inner > header > a.close").click(function(){
                    share_modal.fadeOut(200);
                    return false;
                });
            });
        </script>


    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-69402602-2', 'auto');
    ga('send', 'pageview');

    </script>

</body>
</html>
